% ============================================
% operators.tex — SAFE, MINIMAL, IDEMPOTENT
% Requires: amsmath (already loaded in main)
% ============================================

% ---- Basic constants and differentials (safe) ----
\providecommand{\e}{\mathrm{e}}
\providecommand{\ii}{\mathrm{i}}
\providecommand{\dd}{\mathrm{d}}

% ---- Probability shorthands (safe) ----
\providecommand{\E}{\mathbb{E}}
\providecommand{\Var}{\operatorname{Var}}
\providecommand{\Cov}{\operatorname{Cov}}
\providecommand{\1}{\mathbbm{1}}

% ---- Delimiters (safe) ----
\providecommand{\abs}[1]{\left\lvert #1\right\rvert}
\providecommand{\norm}[1]{\left\lVert #1\right\rVert}
\providecommand{\ip}[2]{\left\langle #1,#2\right\rangle}
\providecommand{\parens}[1]{\left( #1 \right)}
\providecommand{\bracks}[1]{\left[ #1 \right]}

% ---- Safe operator declaration helpers ----
\makeatletter
% Use \@ifundefined to avoid re-declaration errors if a name already exists.
\newcommand{\IfFreeOp}[2]{\@ifundefined{#1}{\DeclareMathOperator{#1}{#2}}{}}
\newcommand{\IfFreeOpStar}[2]{\@ifundefined{#1}{\DeclareMathOperator*{#1}{#2}}{}}
\makeatother

% ---- Common operators (guarded) ----
\IfFreeOp{sgn}{sgn}
\IfFreeOp{tr}{tr}
\IfFreeOp{rank}{rank}
\IfFreeOp{supp}{supp}
\IfFreeOp{Res}{Res}
\IfFreeOp{diag}{diag}
\IfFreeOp{vol}{vol}
\IfFreeOp{area}{area}
\IfFreeOp{length}{length}
\IfFreeOp{diam}{diam}
\IfFreeOp{dist}{dist}
\IfFreeOp{Id}{Id}
\IfFreeOp{arccosh}{arccosh}

% Extremizers (guarded, with limits-style placement)
\IfFreeOpStar{argmin}{arg\,min}
\IfFreeOpStar{argmax}{arg\,max}

% ---- Microlocal / semiclassical notation (guarded) ----
\makeatletter
\@ifundefined{Op}{\DeclareMathOperator{\Op}{Op}}{} % only if not already defined
\@ifundefined{Oph}{\newcommand{\Oph}{\Op_{h}}}{}   % \Oph → \Op_h
\@ifundefined{Opw}{\newcommand{\Opw}{\Op_{h}^{\mathrm{w}}}}{}
\makeatother

% ---- Symbol-class shorthands (plain commands, guarded) ----
\providecommand{\Sm}[1][]{S^{#1}}
\providecommand{\SrhoDelta}[1]{S^{#1}_{1,0}} % default choice; adjust if needed

% ---- Fourier transform aliases (safe) ----
\providecommand{\FT}{\mathcal{F}}
\providecommand{\IFT}{\mathcal{F}^{-1}}
