% ============================================
% operators.tex â€” SAFE & IDEMPOTENT
% Requires: amsmath
% ============================================

% ---- Basics ----
\providecommand{\e}{\mathrm{e}}
\providecommand{\ii}{\mathrm{i}}
\providecommand{\dd}{\mathrm{d}}

% ---- Probability / linear algebra ----
\providecommand{\E}{\mathbb{E}}
\providecommand{\Var}{\operatorname{Var}}
\providecommand{\Cov}{\operatorname{Cov}}
\providecommand{\1}{\mathbbm{1}}

% ---- Delimiters ----
\providecommand{\abs}[1]{\left\lvert #1\right\rvert}
\providecommand{\norm}[1]{\left\lVert #1\right\rVert}
\providecommand{\ip}[2]{\left\langle #1,#2\right\rangle}
\providecommand{\parens}[1]{\left( #1 \right)}
\providecommand{\bracks}[1]{\left[ #1 \right]}

% ---- Guarded operator decl helpers ----
\makeatletter
\newcommand{\IfFreeOp}[2]{\@ifundefined{#1}{\DeclareMathOperator{#1}{#2}}{}}
\newcommand{\IfFreeOpStar}[2]{\@ifundefined{#1}{\DeclareMathOperator*{#1}{#2}}{}}
\makeatother

% ---- Common operators (guarded) ----
\IfFreeOp{sgn}{sgn}            % sign
\IfFreeOp{tr}{tr}
\IfFreeOp{rank}{rank}
\IfFreeOp{supp}{supp}
\IfFreeOp{Res}{Res}
\IfFreeOp{diag}{diag}
\IfFreeOp{vol}{vol}
\IfFreeOp{area}{area}
\IfFreeOp{length}{length}
\IfFreeOp{diam}{diam}
\IfFreeOp{dist}{dist}
\IfFreeOp{Id}{Id}
\IfFreeOp{arccosh}{arccosh}

% Extremizers
\IfFreeOpStar{argmin}{arg\,min}
\IfFreeOpStar{argmax}{arg\,max}

% ---- Semiclassical / microlocal ----
\makeatletter
\@ifundefined{Op}{\DeclareMathOperator{\Op}{Op}}{}
\@ifundefined{Oph}{\newcommand{\Oph}{\Op_{h}}}{}
\@ifundefined{Opw}{\newcommand{\Opw}{\Op_{h}^{\mathrm{w}}}}{}
\makeatother

% ---- Symbol-class shorthands ----
\providecommand{\Sm}[1][]{S^{#1}}
\providecommand{\SrhoDelta}[1]{S^{#1}_{1,0}}

% ---- Fourier transform aliases ----
\providecommand{\FT}{\mathcal{F}}
\providecommand{\IFT}{\mathcal{F}^{-1}}
