% ============================================
% operators.tex â€” SAFE, IDEMPOTENT DEFINITIONS
% ============================================
% Assumes amsmath/amssymb/mathtools/bbm are loaded in the preamble.

% ---- tiny helpers (defined safely) ----
\providecommand{\E}{\mathbb{E}}
\providecommand{\Var}{\operatorname{Var}}
\providecommand{\Cov}{\operatorname{Cov}}
\providecommand{\1}{\mathbbm{1}}
\providecommand{\e}{\mathrm{e}}
\providecommand{\ii}{\mathrm{i}}
\providecommand{\dd}{\mathrm{d}}

% Paired delimiters (keep simple & safe)
\providecommand{\abs}[1]{\left\lvert #1\right\rvert}
\providecommand{\norm}[1]{\left\lVert #1\right\rVert}
\providecommand{\ip}[2]{\left\langle #1,#2\right\rangle}
\providecommand{\bracks}[1]{\left[ #1 \right]}
\providecommand{\parens}[1]{\left( #1 \right)}

% ----- Safe DeclareMathOperator wrappers -----
\makeatletter
\providecommand{\SafeDeclareMathOperator}[2]{%
  \@ifundefined{#1}{\DeclareMathOperator{#1}{#2}}{}%
}
\providecommand{\SafeDeclareMathOperatorStar}[2]{%
  \@ifundefined{#1}{\DeclareMathOperator*{#1}{#2}}{}%
}
\makeatother

% Common operators
\SafeDeclareMathOperator{sgn}{sgn}
\SafeDeclareMathOperator{tr}{tr}
\SafeDeclareMathOperator{rank}{rank}
\SafeDeclareMathOperator{supp}{supp}
\SafeDeclareMathOperator{Res}{Res}
\SafeDeclareMathOperator{diag}{diag}
\SafeDeclareMathOperator{vol}{vol}
\SafeDeclareMathOperator{area}{area}
\SafeDeclareMathOperator{length}{length}
\SafeDeclareMathOperator{diam}{diam}
\SafeDeclareMathOperator{dist}{dist}
\SafeDeclareMathOperator{Id}{Id}
\SafeDeclareMathOperator{arccosh}{arccosh}

% Extremizers
\SafeDeclareMathOperatorStar{argmin}{arg\,min}
\SafeDeclareMathOperatorStar{argmax}{arg\,max}

% ----- Microlocal / semiclassical notation (conflict-free) -----
% If \Op was already defined by a package or elsewhere, do nothing.
\makeatletter
\@ifundefined{Op}{\DeclareMathOperator{\Op}{Op}}{}
\@ifundefined{Oph}{\newcommand{\Oph}{\Op_{h}}}{}
\@ifundefined{Opw}{\newcommand{\Opw}{\Op_{h}^{\mathrm{w}}}}{}
\makeatother

% Pseudodifferential symbol classes (safe)
\providecommand{\Sm}[1][]{S^{#1}}
\providecommand{\SrhoDelta}[2]{S^{#1}_{#2,0}}

% Fourier transform conventions (safe aliases)
\providecommand{\FT}{\mathcal{F}}
\providecommand{\IFT}{\mathcal{F}^{-1}}
